<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<link rel="stylesheet" href="style.css">

<style>
.admin-header {
  padding: 16px;
  font-size: 20px;
  font-weight: bold;
}

.admin-btn {
  background: black;
  color: white;
  padding: 10px 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  margin-bottom: 15px;
}

.admin-card {
  background: #f6f6f6;
  padding: 15px;
  border-radius: 16px;
  margin-bottom: 15px;
}

.admin-card img {
  width: 100%;
  border-radius: 12px;
  margin-bottom: 10px;
}

.admin-form input,
.admin-form textarea,
.admin-form select {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  margin-bottom: 10px;
}

.admin-delete {
  background: #ff3b30;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 10px;
}
</style>
</head>

<body>
<div class="container">

<div class="admin-header">
  Админ панель
</div>

<button class="admin-btn" onclick="openCreateForm()">
  + Добавить объект
</button>

<div id="createForm" style="display:none;">
  <div class="admin-card admin-form">
    <input id="newTitle" placeholder="Название">
    <input id="newPrice" placeholder="Цена">
    <textarea id="newDescription" placeholder="Описание"></textarea>
    <input id="newAddress" placeholder="Адрес">

    <select id="newCategory">
      <option>Подвал</option>
      <option>1 этаж</option>
      <option>Магазин</option>
    </select>

    <input type="file" id="newImages" multiple>

    <button class="admin-btn" onclick="createObject()">Сохранить</button>
  </div>
</div>

<div id="objectsList"></div>

</div>

<script>
const API = "http://147.45.212.213:3001";

async function loadObjects() {
  const res = await fetch(API + "/objects");
  const data = await res.json();

  const container = document.getElementById("objectsList");
  container.innerHTML = "";

  data.forEach(obj => {
    const card = document.createElement("div");
    card.className = "admin-card";

    let imagesHTML = "";
    if (obj.images && obj.images.length > 0) {
      imagesHTML = obj.images.map(img =>
        `<img src="${API}${img}">`
      ).join("");
    }

    card.innerHTML = `
      ${imagesHTML}
      <h3>${obj.title}</h3>
      <p>${obj.price} ₽</p>
      <p>${obj.address}</p>
      <button class="admin-delete" onclick="deleteObject(${obj.id})">
        Удалить
      </button>
    `;

    container.appendChild(card);
  });
}

function openCreateForm() {
  const form = document.getElementById("createForm");
  form.style.display = form.style.display === "none" ? "block" : "none";
}

async function createObject() {
  const formData = new FormData();

  formData.append("title", document.getElementById("newTitle").value);
  formData.append("price", document.getElementById("newPrice").value);
  formData.append("description", document.getElementById("newDescription").value);
  formData.append("address", document.getElementById("newAddress").value);
  formData.append("category", document.getElementById("newCategory").value);

  const files = document.getElementById("newImages").files;
  for (let i = 0; i < files.length; i++) {
    formData.append("images", files[i]);
  }

  await fetch(API + "/objects", {
    method: "POST",
    body: formData
  });

  loadObjects();
  document.getElementById("createForm").style.display = "none";
}

async function deleteObject(id) {
  await fetch(API + "/objects/" + id, {
    method: "DELETE"
  });

  loadObjects();
}

loadObjects();
</script>
</body>
</html>
