<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Админ панель</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #f2f4f8;
}

header {
  background: #6e8ca0;
  color: white;
  padding: 18px;
  font-size: 20px;
  font-weight: bold;
}

.container {
  padding: 15px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.card h3 {
  margin: 0 0 5px;
}

.images-preview {
  display: flex;
  gap: 8px;
  margin: 10px 0;
  flex-wrap: wrap;
}

.images-preview img {
  width: 70px;
  height: 70px;
  object-fit: cover;
  border-radius: 10px;
}

input, textarea, select {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

.save {
  background: #4a90e2;
  color: white;
}

.delete {
  background: #d63031;
  color: white;
}

.add {
  width: 100%;
  background: #6e8ca0;
  color: white;
  margin-bottom: 20px;
}
</style>
</head>

<body>

<header>Админ панель</header>

<div class="container">
  <button class="add" onclick="createObject()">+ Добавить объект</button>
  <div id="objects"></div>
</div>

<script>
const API = "http://147.45.212.213:3001";

async function loadObjects() {
  const res = await fetch(API + "/objects");
  const data = await res.json();
  const container = document.getElementById("objects");
  container.innerHTML = "";

  data.forEach(obj => {
    const card = document.createElement("div");
    card.className = "card";

    const imagesHTML = obj.images?.map(img =>
      `<img src="${API + img}" />`
    ).join("") || "";

    card.innerHTML = `
      <h3>${obj.title}</h3>
      <div class="images-preview">${imagesHTML}</div>

      <input type="text" value="${obj.title}" id="title-${obj.id}">
      <input type="number" value="${obj.price}" id="price-${obj.id}">
      <textarea id="desc-${obj.id}">${obj.description || ""}</textarea>
      <input type="text" value="${obj.address || ""}" id="address-${obj.id}">
      
      <select id="category-${obj.id}">
        <option ${obj.category==="Подвал"?"selected":""}>Подвал</option>
        <option ${obj.category==="1 этаж"?"selected":""}>1 этаж</option>
        <option ${obj.category==="Магазин"?"selected":""}>Магазин</option>
      </select>

      <input type="file" multiple id="images-${obj.id}">
      
      <button class="save" onclick="saveObject(${obj.id})">Сохранить</button>
      <button class="delete" onclick="deleteObject(${obj.id})">Удалить</button>
    `;

    container.appendChild(card);
  });
}

async function createObject() {
  const formData = new FormData();
  formData.append("title", "Новый объект");
  formData.append("price", 0);
  formData.append("description", "");
  formData.append("address", "");
  formData.append("category", "Подвал");

  await fetch(API + "/objects", {
    method: "POST",
    body: formData
  });

  loadObjects();
}

async function saveObject(id) {
  const formData = new FormData();
  formData.append("title", document.getElementById("title-"+id).value);
  formData.append("price", document.getElementById("price-"+id).value);
  formData.append("description", document.getElementById("desc-"+id).value);
  formData.append("address", document.getElementById("address-"+id).value);
  formData.append("category", document.getElementById("category-"+id).value);

  const files = document.getElementById("images-"+id).files;
  for (let i=0; i<files.length; i++) {
    formData.append("images", files[i]);
  }

  await fetch(API + "/objects/" + id, {
    method: "PUT",
    body: formData
  });

  loadObjects();
}

async function deleteObject(id) {
  await fetch(API + "/objects/" + id, {
    method: "DELETE"
  });

  loadObjects();
}

loadObjects();
</script>

</body>
</html>
