<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Добавить объект</title>
<link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="container">
<header class="app-header">
<a href="index.html" class="header-back">←</a>
<div class="header-title">Новый объект</div>
</header>

<div class="form-wrapper">
<input id="title" class="form-input" placeholder="Название">
<input id="price" type="number" class="form-input" placeholder="Цена">
<textarea id="description" class="form-input" placeholder="Описание"></textarea>
<input id="address" class="form-input" placeholder="Адрес">

<select id="category" class="form-input">
<option>Подвал</option>
<option>1 этаж</option>
<option>Магазин</option>
</select>

<input type="file" id="images" multiple class="form-input">
<div id="preview" class="image-preview-grid"></div>

<button class="submit-btn" onclick="createObject()">Сохранить объект</button>
</div>
</div>

<script>
const API = "https://api.evgeny-ivanov-premises.ru";
let imageFiles = [];

/* ПРОВЕРКА АВТОРИЗАЦИИ */
fetch(API + "/check-auth", { credentials: "include" })
.then(res => { if (!res.ok) window.location.href = "login.html"; });

document.getElementById("images").addEventListener("change", function() {
  imageFiles = Array.from(this.files);
});

async function createObject() {
  const formData = new FormData();

  formData.append("title", title.value);
  formData.append("price", price.value);
  formData.append("description", description.value);
  formData.append("address", address.value);
  formData.append("category", category.value);

  imageFiles.forEach(file => formData.append("images", file));

  const res = await fetch(API + "/objects", {
    method: "POST",
    body: formData,
    credentials: "include"
  });

  if (!res.ok) {
    alert("Ошибка создания объекта");
    return;
  }

  window.location.href = "index.html";
}
</script>
</body>
</html>