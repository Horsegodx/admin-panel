<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Редактирование</title>
<link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="container">
<header class="app-header">
<a href="index.html" class="header-back">←</a>
<div class="header-title">Редактирование</div>
</header>

<div class="form-wrapper">
<input id="title" class="form-input">
<input id="price" type="number" class="form-input">
<textarea id="description" class="form-input"></textarea>
<input id="address" class="form-input">

<select id="category" class="form-input">
<option>Подвал</option>
<option>1 этаж</option>
<option>Магазин</option>
</select>

<input type="file" id="images" multiple class="form-input">
<button class="submit-btn" onclick="updateObject()">Сохранить</button>
<button class="delete-btn" onclick="deleteObject()">Удалить</button>
</div>
</div>

<script>
const API = "https://api.evgeny-ivanov-premises.ru";
const id = new URLSearchParams(window.location.search).get("id");

/* ПРОВЕРКА АВТОРИЗАЦИИ */
fetch(API + "/check-auth", { credentials: "include" })
.then(res => { if (!res.ok) window.location.href = "login.html"; });

async function loadObject() {
  const res = await fetch(API + "/objects/" + id, {
    credentials: "include"
  });

  if (!res.ok) {
    window.location.href = "login.html";
    return;
  }

  const obj = await res.json();

  title.value = obj.title;
  price.value = obj.price;
  description.value = obj.description;
  address.value = obj.address;
  category.value = obj.category;
}

async function updateObject() {
  const formData = new FormData();

  formData.append("title", title.value);
  formData.append("price", price.value);
  formData.append("description", description.value);
  formData.append("address", address.value);
  formData.append("category", category.value);

  const res = await fetch(API + "/objects/" + id, {
    method: "PUT",
    body: formData,
    credentials: "include"
  });

  if (!res.ok) {
    alert("Ошибка обновления");
    return;
  }

  window.location.href = "index.html";
}

async function deleteObject() {
  const confirmDelete = confirm("Вы точно хотите удалить объект?");
  if (!confirmDelete) return;

  await fetch(API + "/objects/" + id, {
    method: "DELETE",
    credentials: "include"
  });

  window.location.href = "index.html";
}

loadObject();
</script>
</body>
</html>