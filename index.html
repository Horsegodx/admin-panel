<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <style>
    body {
      margin: 0;
      font-family: Arial;
      background: #f4f4f4;
    }

    header {
      background: #111;
      color: white;
      padding: 16px;
      font-size: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .add-btn {
      background: #00b894;
      border: none;
      color: white;
      font-size: 20px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
    }

    .container {
      padding: 20px;
    }

    .card {
      background: white;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      cursor: pointer;
    }

    .edit-form {
      display: none;
      margin-top: 10px;
    }

    input, textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
    }

    .save-btn {
      background: #0984e3;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
    }

    .delete-btn {
      background: #d63031;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<header>
  Admin Panel
  <button class="add-btn" onclick="createObject()">+</button>
</header>

<div class="container" id="objects"></div>

<script>
const API = "http://147.45.212.213:3001";

async function loadObjects() {
  const res = await fetch(API + "/objects");
  const data = await res.json();

  const container = document.getElementById("objects");
  container.innerHTML = "";

  data.forEach(obj => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <h3>${obj.title}</h3>
      <p>${obj.price} ₽</p>
      <div class="edit-form">
        <input value="${obj.title}" id="title-${obj.id}">
        <input value="${obj.price}" id="price-${obj.id}">
        <textarea id="desc-${obj.id}">${obj.description || ""}</textarea>
        <input value="${obj.address || ""}" id="address-${obj.id}">
        <input value="${obj.category || ""}" id="category-${obj.id}">
        <button class="save-btn" onclick="saveObject(${obj.id})">Сохранить</button>
        <button class="delete-btn" onclick="deleteObject(${obj.id})">Удалить</button>
      </div>
    `;

    card.onclick = () => {
      const form = card.querySelector(".edit-form");
      form.style.display = form.style.display === "block" ? "none" : "block";
    };

    container.appendChild(card);
  });
}

async function saveObject(id) {
  await fetch(API + "/objects/" + id, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      title: document.getElementById("title-" + id).value,
      price: document.getElementById("price-" + id).value,
      description: document.getElementById("desc-" + id).value,
      address: document.getElementById("address-" + id).value,
      category: document.getElementById("category-" + id).value
    })
  });

  loadObjects();
}

async function deleteObject(id) {
  await fetch(API + "/objects/" + id, { method: "DELETE" });
  loadObjects();
}

async function createObject() {
  await fetch(API + "/objects", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      title: "Новое объявление",
      price: 0,
      description: "",
      address: "",
      category: ""
    })
  });

  loadObjects();
}

loadObjects();
</script>

</body>
</html>
