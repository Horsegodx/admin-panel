<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админ панель</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="container">

  <header class="app-header">
    <div class="header-title">Админ панель</div>
  </header>

  <div style="padding:20px;">
    <button class="category-btn" onclick="toggleCreateForm()">
      ➕ Добавить объект
    </button>
  </div>

  <div id="createForm" style="display:none; padding:20px;">
    <input id="new-title" placeholder="Название"><br><br>
    <input id="new-price" type="number" placeholder="Цена"><br><br>
    <textarea id="new-description" placeholder="Описание"></textarea><br><br>
    <input id="new-address" placeholder="Адрес"><br><br>

    <select id="new-category">
      <option>Подвал</option>
      <option>1 этаж</option>
      <option>Магазин</option>
    </select><br><br>

    <input type="file" id="new-images" multiple><br><br>

    <button class="category-btn" onclick="createObject()">
      Сохранить
    </button>
  </div>

  <div class="properties-grid" id="objectsContainer"></div>

</div>

<script>
const API = "/api";

async function loadObjects() {
  const res = await fetch(API + "/objects");
  const data = await res.json();

  const container = document.getElementById("objectsContainer");
  container.innerHTML = "";

  data.forEach(obj => {
    const card = document.createElement("div");
    card.className = "property-card";

    card.innerHTML = `
      <div class="property-info">
        <h3>${obj.title}</h3>
        <div class="address">${obj.address || ""}</div>
        <div class="description">${obj.description || ""}</div>
        <div class="property-price">
          ${Number(obj.price).toLocaleString()} ₽
        </div>
        <br>
        <button onclick="deleteObject(${obj.id})">Удалить</button>
      </div>
    `;

    container.appendChild(card);
  });
}

function toggleCreateForm() {
  const form = document.getElementById("createForm");
  form.style.display = form.style.display === "none" ? "block" : "none";
}

async function createObject() {
  const formData = new FormData();

  formData.append("title", document.getElementById("new-title").value);
  formData.append("price", document.getElementById("new-price").value);
  formData.append("description", document.getElementById("new-description").value);
  formData.append("address", document.getElementById("new-address").value);
  formData.append("category", document.getElementById("new-category").value);

  const files = document.getElementById("new-images").files;
  for (let i = 0; i < files.length; i++) {
    formData.append("images", files[i]);
  }

  await fetch(API + "/objects", {
    method: "POST",
    body: formData
  });

  toggleCreateForm();
  loadObjects();
}

async function deleteObject(id) {
  await fetch(API + "/objects/" + id, {
    method: "DELETE"
  });

  loadObjects();
}

loadObjects();
</script>

</body>
</html>
